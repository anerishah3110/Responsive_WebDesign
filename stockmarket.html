<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src='http://connect.facebook.net/en_US/all.js'></script>
	<script src='http://connect.facebook.net/en_US/all.js'></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<!--<script type="text/javascript" src="path/xmlToJSON.js"></script>-->
<!--	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>-->
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">

	
<!--
	<title>Bootstrap Example</title>
	<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
-->

	
	
<!--    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>-->
	
    
    
    
<!--	<script src='http://connect.facebook.net/en_US/all.js'></script>-->
<!--	<script src='http://connect.facebook.net/en_US/all.js'></script>-->
	
	<!--<script type="text/javascript" src="path/xmlToJSON.js"></script>-->
<!--
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
-->
<!--	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">-->

<!--	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>-->
    	<!--
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src='http://connect.facebook.net/en_US/all.js'></script>
	<script src='http://connect.facebook.net/en_US/all.js'></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script type="text/javascript" src="path/xmlToJSON.js"></script>
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
-->
	<script>
         var favorites_array = [];
        var manual_refresh_array = [];
//        $(document).ready(function(){
//    $('[data-toggle="tooltip"]').tooltip();   
////             $('[data-toggle="toggle tooltip"]').tooltip(); 
//});
		 function favourite(){
            class_name = document.getElementById("star").className;
            var symbol=document.forms["myform"]["text"].value;
            if (class_name == "glyphicon glyphicon-star-empty"){
                document.getElementById("star").className = "glyphicon glyphicon-star yellow";
                add_favourite(symbol);
            }
            else {
                document.getElementById("star").className = "glyphicon glyphicon-star-empty";
                delete_favourite(symbol);
            }
        }
        
        // to add symbols to local storage
        function add_favourite(symbol){
            var symbols = [];
            symbols = JSON.parse(localStorage.getItem("symbols"));
            if (symbols == null || symbols == undefined) {
                symbols = [symbol];
                localStorage.setItem("symbols", JSON.stringify(symbols));
            }
            else {
                symbols.push(symbol);
                localStorage.setItem("symbols", JSON.stringify(symbols));
            }
            update_favourite(symbol);
            //alert(JSON.parse(localStorage.getItem("symbols")));
        }
        
        //To delete symbols in local storage
        function delete_favourite(symbol){
            var symbols_array = JSON.parse(localStorage.getItem("symbols"));
            //alert("delete_fav_before_delete:" + symbols_array);
            if ((symbols_array != null ) && (symbols_array.indexOf(symbol) > -1)) {
                //In the array!
                build_and_update_fav_table(symbols_array,symbol,1);// to delete entry from table before deleting from loal storage.
                var index = symbols_array.indexOf(symbol);
                symbols_array.splice(index,1);//deletes the one element at specified index and rearrages array.
                localStorage.setItem("symbols", JSON.stringify(symbols_array));
            }
            else {
            
                return ;
                
            }
           
        }
       
        function update_favourite(symbol) {
            
                $.ajax({
                    url: "index.php" ,
                    data: {
                    q: symbol
                    },
                    dataType:'JSON',
                    success: function(json_array) {
                        build_and_update_fav_table(json_array,symbol,0);
                    }
            });
            
        }
       function build_and_update_fav_table(json_array,symbol,delete_entry){
            
            if (delete_entry == 0){
                var table = document.getElementById("mytable");
                var row = table.insertRow(-1);
                
                html_trash = '<button type="button" class="btn btn-default btn-sm" onclick="delete_row(this);"><span class="glyphicon glyphicon-trash"></span></button>';
                
                html_anchor = "<a href='#' id=' "+ json_array.Symbol+"' onclick='gets(this.id);'>" + json_array.Symbol + "</a>"
               
                
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
            
            // Add some text to the new cells:
                cell1.innerHTML = html_anchor;
                cell2.innerHTML = json_array.Name;
                cell3.innerHTML = "$" + json_array.LastPrice.toFixed(2);
               // cell4.innerHTML = json_array.ChangePercent;
                   if ( json_array.Change.toFixed(2) < 0)
               {
                   cell4.innerHTML = "<font color=red>" + json_array.Change.toFixed(2) + "(" + json_array.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>";
                                } else
               {
                   cell4.innerHTML = "<font color=Green>" +json_array.Change.toFixed(2) + "(" + json_array.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>";
               }
               // cell5.innerHTML = json_array.MarketCap;
                
                  var cap= (json_array.MarketCap)/1000000000;
               if ( cap > 0.005)
               {
                   cell5.innerHTML+= cap.toFixed(2) + "B";
               }
               else
               {
                   var num= cap*1000;
                   cell5.innerHTML+=  num.toFixed(2)+" M";
               }
                cell6.innerHTML = html_trash;
                
                if(favorites_array != null && favorites_array.length != 0){
                    current_symbol = favorites_array.splice(0,1);
                    update_favourite(current_symbol[0]);
                }
            }
            else {// logic to delete a row from favourites table
                
                var index = json_array.indexOf(symbol);
                document.getElementById("mytable").deleteRow(index+1);
            }
        }
         function delete_row(link){
            var row = link.parentNode.parentNode;
            var x = row.cells;
            //below logic is to extract symbol name from html tag that is in columun[0].
            var el = document.createElement( 'html' );
            el.innerHTML = "<html><head></head><body>" + x[0].innerHTML+ "</body></html>";
            var symbol = el.getElementsByTagName( 'a' );
         delete_favourite(symbol[0].innerHTML);
           
        }
       
        $(window).load(function() {
            //console.log( "ready!" );
            favorites_array = JSON.parse(localStorage.getItem("symbols"));
            
            if (favorites_array != null && favorites_array.length != 0 ) {
                
                    current_symbol = favorites_array.splice(0,1);
                    update_favourite(current_symbol[0]);
                    
                //}
            }
        });
       function manual_refresh(){
         //  alert("manual_refresh");
           manual_refresh_array = JSON.parse(localStorage.getItem("symbols"));
           
            if (manual_refresh_array != null && manual_refresh_array.length != 0  ) {
                current_symbol = manual_refresh_array.splice(0,1);
                
            
                update_manual_refresh(current_symbol[0]);
            }
       }
        
        function update_manual_refresh(current_symbol) {
                    $.ajax({
                    url: "index.php" ,
                    data: {
                    q: current_symbol
                    },
                    dataType:'JSON',
                    success: function(json_array) {
                        refresh_update(json_array);
                    }
                });
        }
        function refresh_update(json_array) {
            
            local_array = JSON.parse(localStorage.getItem("symbols"));
            index = local_array.indexOf(json_array.Symbol);
            if (index < -1  || index == -1) {
              
                return;
            }
          
            
            document.getElementById("mytable").rows[index+1].cells[2].innerHTML = "$" + json_array.LastPrice;
          
             if ( json_array.Change.toFixed(2) < 0)
                {
                    document.getElementById("mytable").rows[index+1].cells[3].innerHTML= "<font color=red>" + json_array.Change.toFixed(2) + "(" + json_array.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'>";
				} else 
                {
                    document.getElementById("mytable").rows[index+1].cells[3].innerHTML= "<font color=Green>" +json_array.Change.toFixed(2) + "(" + json_array.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'>";

                }
            
          //  document.getElementById("mytable").rows[index+1].cells[3].innerHTML = json_array.ChangePercent;
            
            if (manual_refresh_array != null && manual_refresh_array.length != 0 ) {
                current_symbol = manual_refresh_array.splice(0,1);
                update_manual_refresh(current_symbol[0]);
            }   
        }
        
        
           

		$(document).ready(function () {
            
//             function toggleOn() {
//                  this.checked=true;
//                }
//                function toggleOff() {
//                 this.checked=false;
//                }
            
            
             var interval = null;
            $("#auto_refresh_trigger").change(function() {
               
                if(this.checked) {
                                       interval = setInterval(function(){ 
                    manual_refresh();
                    }, 5000);
                }
                else{
                    clearInterval(interval);	}
                      });
            
            
            
            
           
            
            $(function () {
				$("#text").autocomplete({
					source: "index.php",
					minLength: 1
				});
			});

          
    

            
           $( "#myform" ).submit(function( event ) {
               
                  document.getElementById("carousel_right").disabled = false;

				ch = document.getElementById('text').value;
				//                              alert(ch);
				$.ajax({
						type: "GET",
						url: "index.php",
						dataType: 'json',
						data: {
							q: $('#text').val()
						}
                   
                       
					})
               
					.done(function (msg) {
                //    $('.nav-tabs a[href="#"]').tab('show');
                     
              document.getElementById("sd").className="active";
                    //$('#hc').parent().removeClass('active');
                    document.getElementById("nf").className="deactive";
                     document.getElementById("hc").className="deactive";
                    
           document.getElementById("stock1").className="tab-pane active";
                  //  document.getElementById("high1").className="tab-pane active";
                   // document.getElementById("stock1").className="tab-pane active";
                    
                    
                
                var s=JSON.stringify(msg);
                   
                    
                     if(!msg.Message){
                          document.getElementById("carousel_right").click();
                         
                         document.getElementById("val").innerHTML="";
						data1 = msg;

                        r=msg.Symbol;
						var t_str = " <table class='table table-striped table-responsive'>";
						t_str += "<tr><td>Name</td><td>";
						t_str += msg.Name;
						t_str += "</td><tr><td>Symbol</td><td>"
						t_str += msg.Symbol;
						t_str += "</td><tr><td>Last Price</td><td>"
						t_str += "$" + msg.LastPrice.toFixed(2);
						t_str += "</td><tr><td>Change(Change Percent)</td><td>"
						if (msg.Change.toFixed(2) < 0) {
							t_str += "<font color=red>" + msg.Change.toFixed(2) + "(" + msg.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'";
						} else {
							t_str += "<font color=Green>" + msg.Change.toFixed(2) + "(" + msg.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'";

						}
						t_str += "</td><tr><td>Time and Date</td><td>"
                        function timeConverter(UNIX_timestamp)

              {

                  var a = new Date(UNIX_timestamp);

                  var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

                  var year = a.getFullYear();

                  var month = months[a.getMonth()];

                  var date = a.getDate();

                  var hour = a.getHours();

                  var min = a.getMinutes();

                  var sec = a.getSeconds();

                   if(hour>11)

                    {

                      var time = date + ' ' + month + ' ' + year + ', ' + hour + ':' + min + ':'+sec +' pm' ;

                       return time;

                    }

                    else

                   {

                      var time = date + ' ' + month + ' ' + year + ', ' + hour + ':' + min + ':'+sec + ' am' ;

                     return time;

                   }

              }

                    var d = Date.parse(msg.Timestamp);

                    var dat = timeConverter(d);

             

             

              
						t_str += dat;
						t_str += "</td><tr><td>Market Cap</td><td>"
						t_str += (msg.MarketCap / 1000000000).toFixed(2) + "B";
						t_str += "</td><tr><td>Volume</td><td>"
						t_str += msg.Volume;
						t_str += "</td><tr><td>Change YTD(Change Percent YTD)</td><td>"
						if (msg.ChangeYTD.toFixed(2) < 0) {
							t_str += "<font color=red>" + msg.ChangeYTD.toFixed(2) + "(" + msg.ChangePercentYTD.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'";

						} else {
							t_str += "<font color=Green>" + msg.ChangeYTD.toFixed(2) + "(" + msg.ChangePercentYTD.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'";

						}
						t_str += "</td><tr><td>High Price</td><td>"
						t_str += "$" + msg.High.toFixed(2);
						t_str += "</td><tr><td>Low price</td><td>"
						t_str += "$" + msg.Low.toFixed(2);
						t_str += "</td><tr><td>Opening Price</td><td>"
						t_str += "$" + msg.Open.toFixed(2);
						t_str += "</td></table>"

						document.getElementById("stock").innerHTML = t_str;
						var str = "<img src='http://chart.finance.yahoo.com/t?s=" + ch + "&lang=en-US&width=400&height=300' class='img-responsive'>";

						document.getElementById("chart").innerHTML = str;
                  
                        var symbol1=document.forms["myform"]["text"].value;                      
                    symbol_array = JSON.parse(localStorage.getItem("symbols"));
                        
                         
           if ((symbol_array != null ) && symbol_array.indexOf(symbol1) > -1) {
               //In the array!
               document.getElementById("star").className = "glyphicon glyphicon-star yellow";
           } else {
               //Not in the array
               document.getElementById("star").className = "glyphicon glyphicon-star-empty";
           }


                    }
                    
                    else{
                  
						
                        document.getElementById("val").innerHTML="Select a Valid Entry";
                    }
                    
                    
					});
			

 // alert( "Handler for .submit() called." );
event.preventDefault();
               
               
//               $("#news").click(function () {
//                
//                
//           var symbol=document.forms["myform"]["text"].value;
//           $.ajax({
//                   url: "index.php" ,
//                   data: {
//                   symbol_newsfeed: symbol
//                   },
//                   //dataType:'JSON',
//                   success: function(json_array) {
//                       document.getElementById("news1").innerHTML= json_array;
//                       //display_newsfeed(json_array);
//                   }
//           });
//            });
                $("#clear").click(function(){
               
                document.getElementById("text").value="";
                  document.getElementById("carousel_left").click();
                document.getElementById("carousel_right").disabled = true;
                
            });



				});
               
});


			
			
       
				
//				var n = document.getElementById('text').value;
//				
//				var target = "https://ajax.googleapis.com/ajax/services/search/news?v=1.0&q=" + n + "&userip=10.123.20.120";
//				$.ajax({
//					url: target,
//					cache: false,
//					dataType: 'jsonp',
//					success: function (data) {
//						var b = "";
//						for (var i = 1; i < data.responseData.results.length; i++) {
//							b += "<div class=jumbotron> <a href='" + data.responseData.results[i].unescapedUrl + "'>" + data.responseData.results[i].titleNoFormatting + " </a> <br><p>" + data.responseData.results[i].content + " </p> <br> Publisher:" + data.responseData.results[i].publisher + " <br> Date:" + data.responseData.results[i].publishedDate + "</div><br>";
//
//
//
//						}
//						document.getElementById("news1").innerHTML = b;
//						// alert(data.responseData.results[0].titleNoFormatting);
//					},
//					error: function (jxhr, e) {
//						alert(jxhr.status + " - " + e.responseText);
//					}
//				})
//			});
            
           
        
        
        //$(document).ready();
        

		// our data object
		// what type of data do we expect back from the server


		// using the done promise callback



//		function toggleOn() {
//		  $('#toggle-trigger').bootstrapToggle('on')
//		}
//		function toggleOff() {
//		  $('#toggle-trigger').bootstrapToggle('off')
        
        
        
//		}
        function gets(m){
            
             document.getElementById("carousel_right").disabled = false;
             t=m.trim();
            	$.ajax({
						type: "GET",
						url: "index.php",
						dataType: 'json',
						data: {
							q:t
						}
                   
                       
					})
               
					.done(function (msg) {
                //    $('.nav-tabs a[href="#"]').tab('show');
                     
              document.getElementById("sd").className="active";
                    //$('#hc').parent().removeClass('active');
                    document.getElementById("nf").className="deactive";
                     document.getElementById("hc").className="deactive";
                    
           document.getElementById("stock1").className="tab-pane active";
                  //  document.getElementById("high1").className="tab-pane active";
                   // document.getElementById("stock1").className="tab-pane active";
                    
                    
                
                var s=JSON.stringify(msg);
                   
                    
                     if(!msg.Message){
                          document.getElementById("carousel_right").click();
                         
                         document.getElementById("val").innerHTML="";
						data1 = msg;
                         r=msg.Symbol;

                        
						var t_str = " <table class='table table-striped table-responsive' >";
						t_str += "<tr><td>Name</td><td>";
						t_str += msg.Name;
						t_str += "</td><tr><td>Symbol</td><td>"
						t_str += msg.Symbol;
						t_str += "</td><tr><td>Last Price</td><td>"
						t_str += "$" + msg.LastPrice.toFixed(2);
						t_str += "</td><tr><td>Change(Change Percent)</td><td>"
						if (msg.Change.toFixed(2) < 0) {
							t_str += "<font color=red>" + msg.Change.toFixed(2) + "(" + msg.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'";
						} else {
							t_str += "<font color=Green>" + msg.Change.toFixed(2) + "(" + msg.ChangePercent.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'";

						}
						t_str += "</td><tr><td>Time and Date</td><td>"
                        function timeConverter(UNIX_timestamp)

              {

                  var a = new Date(UNIX_timestamp);

                  var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

                  var year = a.getFullYear();

                  var month = months[a.getMonth()];

                  var date = a.getDate();

                  var hour = a.getHours();

                  var min = a.getMinutes();

                  var sec = a.getSeconds();

                   if(hour>11)

                    {

                      var time = date + ' ' + month + ' ' + year + ', ' + hour + ':' + min + ':'+sec +' pm' ;

                       return time;

                    }

                    else

                   {

                      var time = date + ' ' + month + ' ' + year + ', ' + hour + ':' + min + ':'+sec + ' am' ;

                     return time;

                   }

              }

                    var d = Date.parse(msg.Timestamp);

                    var dat = timeConverter(d);

             

             

              
						t_str += dat;
						t_str += "</td><tr><td>Market Cap</td><td>"
						t_str += (msg.MarketCap / 1000000000).toFixed(2) + "B";
						t_str += "</td><tr><td>Volume</td><td>"
						t_str += msg.Volume;
						t_str += "</td><tr><td>Change YTD(Change Percent YTD)</td><td>"
						if (msg.ChangeYTD.toFixed(2) < 0) {
							t_str += "<font color=red>" + msg.ChangeYTD.toFixed(2) + "(" + msg.ChangePercentYTD.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/down.png'";

						} else {
							t_str += "<font color=Green>" + msg.ChangeYTD.toFixed(2) + "(" + msg.ChangePercentYTD.toFixed(2) + "%) <img src='http://cs-server.usc.edu:45678/hw/hw8/images/up.png'";

						}
						t_str += "</td><tr><td>High Price</td><td>"
						t_str += "$" + msg.High.toFixed(2);
						t_str += "</td><tr><td>Low price</td><td>"
						t_str += "$" + msg.Low.toFixed(2);
						t_str += "</td><tr><td>Opening Price</td><td>"
						t_str += "$" + msg.Open.toFixed(2);
						t_str += "</td></table>"

						document.getElementById("stock").innerHTML = t_str;
						var str = "<img src='http://chart.finance.yahoo.com/t?s=" + t + "&lang=en-US&width=400&height=300' class='img-responsive'>";

						document.getElementById("chart").innerHTML = str;
                  
                        var symbol2=t;                     
                    symbol_array = JSON.parse(localStorage.getItem("symbols"));
                      
                         
           if ((symbol_array != null ) && symbol_array.indexOf(symbol2) > -1) {
               //In the array!
               document.getElementById("star").className = "glyphicon glyphicon-star yellow";
           } else {
               //Not in the array
               document.getElementById("star").className = "glyphicon glyphicon-star-empty";
           }


                    }
                    
                    else{
                  
						// alert("no");
                        document.getElementById("val").innerHTML="Select a Valid Entry";
                    }
                    
            
                    
        });
        
//              $("#news").click(function () {
//                
//                
//           var symbol=document.forms["myform"]["text"].value;
//           $.ajax({
//                   url: "index.php" ,
//                   data: {
//                   symbol_newsfeed: t
//                   },
//                   //dataType:'JSON',
//                   success: function(json_array) {
//                       document.getElementById("news1").innerHTML= json_array;
//                       //display_newsfeed(json_array);
//                   }
//           });
//            });
                $("#clear").click(function(){
                
                document.getElementById("text").value="";
                  document.getElementById("carousel_left").click();
                document.getElementById("carousel_right").disabled = true;
                
            });
                
            
        }
        function nf(z)
        {
            $.ajax({
                   url: "index.php" ,
                   data: {
                   symbol_newsfeed: z
                   },
                   //dataType:'JSON',
                   success: function(json_array) {
                       document.getElementById("news1").innerHTML= json_array;
                       //display_newsfeed(json_array);
                   }
            });
        }
        
        
        
       
	</script>
    <style>
        
      
	.well 
	{
	background:white;
	}
        #val{
            color:red;
        }
        
        .yellow{
            color:yellow;
        }
        
        
        
        body{
        background-image: url('blue.jpg');}
        
        
	
	</style>	
    </style>
	
</head>

<body>
	<div class="container">
		<div class="well" style="margin-top:10px ">
			<div class="text-center" style="margin-bottom:13px "><div class="h4">Stock market Search</div></div>
			<div class="row">
				<form class="form-inline" id="myform" name="myform" >
					<div class="col-md-3" style="margin-bottom:10px"><label for="company"> Enter the stock name or symbol:<span style="color:red">*</span></label></div>
					<div class="col-md-4" style="margin-bottom:15px"><input class="form-control autocomplete" id="text" name="text" size="73" type="text" required="required" placeholder="Apple Inc or AAPL">	</div>			
                    <div class="col-md-offset-2 col-md-3" style="margin-bottom:13px"> <button type="submit" class="btn btn-primary" id="quote"> <span class="glyphicon glyphicon-search" ></span> Get Quote </button> 
					<button type="button" class="btn btn-default" id="clear"> <span class="glyphicon glyphicon-refresh"></span> Clear </button> </div>
				</form>
			</div>
			<div class="row" >
                <div class="col-md-offset-3 col-md-4">
                    <span id="val"></span>
                </div>
				<div class="col-md-offset-2 col-md-3" >
					<strong style="margin-left:15px">Powered by: </strong> 
					<a href="http://dev.markitondemand.com/MODApis/" target="_blank"><img width="120 px" height="25px" src="http://cs-server.usc.edu:45678/hw/hw8/images/mod-logo.png" /> </a>
				</div>
			</div>
			
		</div>
		
		<hr>
		
		<div class="well">
		<div class="carousel slide" id="myCarousel" data-interval="false">
			<div class="carousel-inner">
				<div class="item active">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="row">
								<div class="col-md-2 "><strong>Favourite List</strong></div>
                                <div class="col-md-offset-6 col-md-2"><span style="margin-left:35px"><span class="hidden-xs">Automatic refresh:</span></div>
								<div class="col-md-2">
							<span title="Automatic Refresh">		<input  id="auto_refresh_trigger" type="checkbox" data-toggle="toggle" /></span>
									<button type="button" class="btn btn-default "  onclick="manual_refresh();" data-toggle="tooltip" title="Refresh Button"><span class="glyphicon glyphicon-refresh"></span> </button>
									<a href="#myCarousel" role="button" data-slide="next">
										<button type="button" class="btn btn-default" id="carousel_right" data-toggle="tooltip" title="Go To Stock Information" disabled> <span class="glyphicon glyphicon-menu-right"  ></span> </button>
									</a>
								</div>
							</div>
						</div>
						<div class="panel-body">
                     <table class='table table-striped table-responsive' id="mytable">
           <thead>
               <tr>
                   <th>Symbol</th>
                   <th>Company Name</th>
                   <th>Stock Price</th>
                   <th>Change(Change Percent)</th>
                   <th>Market Cap</th>
               </tr>
           </thead>
              <tbody id="table_body">

             </tbody>
         </table>  
						</div>
					</div>
					
				</div>
				
				<div class="item">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="row">
								<div class="col-md-1 col-xs-1 text-left">
									<a href="#myCarousel" role="button" data-slide-to="0">
										<button type="button" class="btn btn-default " id="carousel_left">
												<span class="glyphicon glyphicon-menu-left"></span>
										</button>
									</a></div>
                                <div class="text-center col-md-11 col-xs-11"><b>Stock Details</b></div>
							
							</div>
						</div>
						<div class="panel-body">
<!--                            <div class="col-md-12"  >-->
							<ul class="nav nav-pills" role="tab-list">
								<li role="presentation" class="active" id="sd">
									<a role="tab" data-toggle="pill" href="#stock1" ><span class="glyphicon glyphicon-dashboard"></span><span class="hidden-xs" >Current</span> Stock</a>
								</li>
								
								<li role="presentation" id="hc">
                                    <a role="tab" data-toggle="pill" href="#tab2" id="high" onclick="hc(r);"><span class="glyphicon glyphicon-stats"></span><span class="hidden-xs" > Historical </span>Charts</a>
								</li>
								
								<li role="presentation" id="nf">
                                    <a role="tab" data-toggle="pill" href="#tab3" id="news" onclick="nf(r);"><span class="glyphicon glyphicon-link"> </span>News<span class="hidden-xs" > Feed</span></a>
								</li>
							</ul>
                            <hr>
							
							<div class="tab-content">
								<div role="tabpanel" class="tab-pane active" id="stock1"> 
									<div class="row">
										<div class="col-md-2" > <b>Stock Details </b></div>
										<div class="col-md-2 col-md-offset-8" >
											<a id="fb" href="javascript:shareFB()"> 
                                        <img src="logo.png" height="35px" width="35px" style="margin-top:0">
                                        </a>
														<button class="btn btn-default"  onclick="favourite();"><span class="glyphicon glyphicon-star-empty"  id="star" name="star"></span></button>
										</div>
									</div>
									
									<div class="row">
										<div class="col-md-6" id="stock"></div>
<!--										<div class="col-md-offset-1 col-md-5" id="chart"></div>-->
											<div class="col-md-6" id="chart"></div>
									</div>
								</div>
								
								<div role="tabpanel" class="tab-pane" id="tab2"> 
								<div class=row>
                                    <div class="col-md-12" id="high1">
                                    </div>
                                    </div>
								</div>
								
								<div role="tabpanel" class="tab-pane" id="tab3"> 
                                    <div class=row>
                                    <div class="col-md-12" id="news1">
                                    </div>
                                    </div>
								
								</div>
							</div>
						</div>
                        </div>
					</div>
				</div>
				
			</div>		
		</div>
		</div>
		
	</div>
	<script>

        function hc(u)
        {
					
					
						//alert("in high");
						//var a = document.getElementById('text').value;
						//alert(u);
						//var target1 = "http://dev.markitondemand.com/MODApis/Api/v2/InteractiveChart/json?parameters={'Normalized':false,'NumberOfDays':1095,'DataPeriod':'Day','Elements':[{'Symbol':" + a + ",'Type':'price','Params':['ohlc']}]}";

						var html_string = new Array();
						Date.prototype.getUnixTime = function () {
							return this.getTime() / 1000 | 0
						};
						if (!Date.now) Date.now = function () {
							return new Date();
						}
						Date.time = function () {
							return Date.now().getUnixTime();
						}

						var html_string = new Array();



						mySeries = [];

						$.ajax({
							url: 'index.php',
							data: {
								hc: u
							},
							dataType: 'JSON',
							success: function (json_array) {

								var ht = JSON.parse(json_array);
								var datearr = ht['Dates'];


								var Open_val = ht.Elements[0].DataSeries.open.values;
								var High_val = ht.Elements[0].DataSeries.high.values;
								var Low_val = ht.Elements[0].DataSeries.low.values;
								var Close_val = ht.Elements[0].DataSeries.close.values;

								for (i = 0; i < datearr.length; i++) {
									var someDate = new Date(datearr[i]);
									//document.getElementById('result').innerHTML+=someDate+"&nbsp;&nbsp;";
									var theUnixTime = someDate.getTime();

									var temp = new Array();
									temp[0] = theUnixTime;
									temp[1] = Open_val[i];
									temp[2] = High_val[i];
									temp[3] = Low_val[i];
									temp[4] = Close_val[i];
									html_string[i] = temp;


								}

								$('#high1').highcharts('StockChart', {
									xAxis: {
										dateTimeLabelFormats: {
											hour: '%e. %b<br><span style="font-size: 8px">%H:%M</span>'
										}
									},

									rangeSelector: {
										allButtonsEnabled: true,
										buttons: [{

											type: 'week',
											count: 1,
											text: '1w'
                  }, {
											type: 'month',
											count: 1,
											text: '1m'
                  }, {
											type: 'month',
											count: 3,
											text: '3m'
                  }, {
											type: 'month',
											count: 6,
											text: '6m'
                  }, {
											type: 'ytd',
											text: 'YTD'
                  }, {
											type: 'year',
											count: 1,
											text: '1y'
                  }, {
											type: 'all',
											text: 'All'
                  }],
										selected: 0,
										inputEnabled: false
									},
									title: {
										text: u + ' Stock Value'
									},
									yAxis: {

										title: {

											text: 'Stock Value',

										}
									},
									series: [{
										name: u + ' Stock Value',
										data: html_string,
										type: 'area',
										threshold: null,
										tooltip: {
                                            valuePrefix:"$",
											valueDecimals: 2
										},
										fillColor: {
											linearGradient: {
												x1: 0,
												y1: 0,
												x2: 0,
												y2: 1
											},
											stops: [
                        [0, Highcharts.getOptions().colors[0]],
                        [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                    ]
										}
            }]
								});

							}

						});





                    }


			
			</script>
			<script>
				window.fbAsyncInit = function () {
					FB.init({
						appId: '1754035364830798',
						xfbml: true,
						version: 'v2.5'
					});
				};
				(function (d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) {
						return;
					}
					js = d.createElement(s);
					js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
				var data1;
				var ch;

				function shareFB() {
					// alert("fb");

					FB.init({
						appId: '1754035364830798',
						xfbml: true,
						version: 'v2.5'
					});

					FB.getLoginStatus(function (response) {
						if (response.status == "connected") {

							console.log("connected");
							postFB();
						} else {

							console.log("blah");
							// the user isn't logged in to Facebook.
							FB.login(function (response) {
								if (response.status == "connected") {
									console.log("I am in login function");
									postFB();
								} else {
									console.log("Outside postFB");
									//alert('Not Posted');
								}
							});
						}
					});
				}

				function postFB() {
					console.log("In post FB function");
					FB.ui({
						method: 'feed',
						name: 'Current stock price of ' + data1.Name + ' is $' + data1.LastPrice.toFixed(2),
						link: 'http://dev.markitondemand.com/',
						picture: 'http://chart.finance.yahoo.com/t?s=' + ch + '&lang=en-US&width=400&height=300',
						description: 'Stock Information of ' + data1.Name + '(' + data1.Symbol + ')',
						caption: 'LAST TRADE PRICE: $' + data1.LastPrice.toFixed(2) + ', CHANGE:' + data1.Change.toFixed(2) + '(' + data1.ChangePercent.toFixed(2) + '%)',
						display: 'popup'
					}, function (response) {
						if (response && !response.error_message) {
							alert('Posted Successfully');
						} else {
							alert('Not Posted');
						}
					});
                }
			</script>
</body>

</html>